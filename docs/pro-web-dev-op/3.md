第
章 3

Web 测试实践

测试 web 应用程序不仅需要测试站点本身，还需要查看堆栈中每一层的各种应用程序指标。这就像制造一架飞机:飞机的每一部分在成为整体的一部分之前，都必须经过工程设计和安全测试。一旦每个子系统都被开发和测试，它们都可以组装成成品进行试飞。对于这样一个复杂的系统，只有在你认为最终产品会让你成功之前，确保你可以信任单个部件才有意义。

一个网站也差不多。它也是由各种组件和子系统组成的，例如网络、数据库、应用程序逻辑和前端，这些组件和子系统被安排成层或层，甚至可能在每一层都有多个系统交互。一般来说，测试一个网站需要遵循以下步骤:

1.  决定在哪里测试(即测试哪些层)。
2.  在测试之前，确定业务和工程团队分别对哪些指标感兴趣。
3.  为每一层实现不同的、独立的测试技术。
4.  整体测试整个网站。

当出现错误或性能不尽如人意时，遵循这些步骤将更容易查明站点中的问题。

这听起来可能很简单，但是在实现任何类型的测试方法之前，您需要知道要寻找什么。这需要在设置和安排测试以及分配测试资源之前，理解业务的性质以及什么度量是重要的。您必须考虑哪些测试用例将在最少的时间内产生最多的价值。理想情况下，所有的软件都应该被测试，但是测试软件的每个部分并不总是可行的。我们测试是因为我们想改进我们的软件，简单地测试一切浪费时间和金钱，而且适得其反。

逐层回顾测试阶段和周期的历史数据是非常有帮助的。此外，从最终用户的角度来看整个网站(运用整个堆栈),将减少识别和定位用户遇到的问题所需的时间。

随着行为驱动开发(BDD) 的出现，Web 软件测试正在发生巨大的变化，这是一种根据软件执行特定目标的预期结果或验收标准来编写软件和单元测试的方法。但是有许多不同的方法在 Web 测试中有一席之地和用途。我概述了其中一些测试，以及它们如何应用于各种结果。

网络测试实践

保证软件质量不是一个部门的责任。Web 开发人员、操作工程师和质量保证工程师都应该有能力执行任何类型的测试，只要他们都使用一些通用的工具集来这样做；所有的涉众都应该参与保证软件的质量。这可能需要将测试集成到您的测试框架和持续集成流程中，或者采用一些自动化测试的方法，以便快速、高效地了解 web 堆栈或应用程序的性能。

为了了解软件的运行情况，运行不同种类的测试是很重要的，包括功能测试和压力测试，尤其是在开发一个新应用的时候。对于成熟的应用程序，您会希望了解应用程序的历史表现，这可能会减少执行更复杂的压力测试的需要，例如最大容量和持续负载测试。通过收集关于每一层如何单独执行的基线来积累数据，在每一层(如 Web、应用程序和数据库层)执行这些侵入式测试的需求最终可能会减少或完全消除。如果这些实践是自动化的，它们可以被集成到软件开发生命周期中，或者它们可以定期运行。

对于一个组织应该如何测试其软件，没有硬性的规则，尽管遵循公认的实践将帮助任何组织生产更好的软件，并减少客户在生产使用中看到的错误数量。当然，每种测试的详细程度、频率和自动化程度会根据 web 应用程序的复杂性、应用程序的使用量以及应用程序为企业带来的收入而有所不同。复杂的、高使用率的、产生大量收入的应用程序将需要 web 开发人员和操作工程师密切合作，以确保高可用性和故障转移在应用程序和基础设施中都存在，并经过彻底的测试。

以下规则决定了您需要对 Web 应用程序进行多少测试:

*   复杂性。网站或应用程序越复杂，可能需要的测试就越多。例如，进行数据挖掘或金融行业计算的应用程序可能比基于 LAMP (Linux Apache MySQL)的 Web 应用程序需要更多的测试。与每天都有数百万用户访问的网站或应用程序相比，彻底测试一个只供一小部分内部用户使用的 web 应用程序需要的测试不那么严格和彻底。应用程序收到的使用越多，奇怪的边缘情况导致它失败的概率就越高；这应该在应用程序投入生产之前进行调查。
*   成本。即使一个网站获得了大量的使用，也不一定能产生大量的收入。每天产生数百万、数十万甚至数万美元收入的网站和应用程序通常对公司的底线更为重要，因此需要更多的测试，因为它们存在宕机的财务风险。
*   文化。如果您的工程团队习惯于接受和编写他们自己的测试，您可能不需要其他团队进行同样多的测试，例如专门的 QA 部门。尽管如此，其他部门可能不得不参与一些测试。

最大容量测试

最大容量测试(压力测试)包括将负载推给最终用户服务，以找到 web 应用程序或网站崩溃和停止运行的点。这种做法对于规划容量和确定给定应用程序可以处理多少压力或负载至关重要。这总是一个在您的测试环境中内部执行的合成测试。您不应该在生产站点上执行最大容量测试，因为这可能会导致停机，影响企业收入。最大容量测试可能会揭示代码中的问题。在相对较轻的负载或相对较少的会话数下出现问题的应用程序可能有一些主要的功能问题，需要在测试继续之前解决。

**好处:**当请求的数量超过可用资源和硬件的能力，或者更有可能是被测试软件的能力时，每个应用程序都会崩溃。最大容量测试可以发现明显的编码错误，而不需要繁重的调查工作或等待持续的负载测试完成。对于有问题的应用程序，您通常会在测试后的日志文件中发现大量错误，日志分析引擎可以检查并处理这些错误，以揭示应用程序中最常见的错误。

持续负载测试

持续负载测试(浸泡测试)是在不同类型的负载下，长时间测试网站或应用程序的实践。这有助于在将代码投入生产之前清除任何问题。持续负载测试通常只针对主要的软件变更或发布进行，可能需要 24 小时到几天的时间。

执行持续负载测试的一个更积极的策略是，将新代码放在一小组服务器上，并使用负载平衡器将一些流量卸载到这些服务器上，然后将这些具有新代码的服务器首先投入到生产环境中。这给了开发人员和操作工程师一个机会来了解新代码在生产中的表现。

例如，所有生产流量的 10%应该放入新的代码库，看看它如何执行，而不会冒在生产中运行 100%的新代码和看着网站崩溃的风险。

**好处:**持续负载测试揭示了一个 Web 应用程序的各个组件在一段时间内的运行情况。这对于暴露缓慢的内存泄漏、依赖于时间的错误(例如，只在一天中的特定时间出现的错误)特别有用，并且有时可以发现高负载测试无法解决的问题。这种类型的测试很重要，但是由于运行时间长而受到限制，这可能是有问题的，尤其是在短开发周期中。

行为驱动发展

最终用户指标提供了网站作为一个整体如何运行的画面，它们有助于快速有效地揭示问题，在这一点上可以做出进一步和更深入的诊断。行为驱动开发是一种敏捷的开发技术，它将用户“故事”合并到开发过程中，使得跟踪度量标准更加容易。BDD 的一个重要方面是它鼓励 Web 开发人员和操作专业人员甚至非技术用户之间的协作。通过使用 BDD 框架，比如 Cucumber Test Framework，Web 开发人员、操作人员甚至业务用户可以用简单的英语格式描述软件应该做什么，然后将它映射到在 Web 应用程序上执行给定测试的编程逻辑。

Aslak Hellesoy 是黄瓜测试框架的创建者，也是 DRW 交易集团的高级软件工程师。Chris Read 是 DRW 交易集团的开发人员和运营工程师，也是黄瓜测试框架的积极贡献者。他们在下面的文章中分享了他们对测试的见解。

将测试 整合到你的开发过程中的重要性是什么？

***无级海勒罗伊***

通过测试，我们可以在需要的时候修改软件。我们工作的环境是，我们的客户是(证券)交易者，他们一直需要很多功能，比如一天几次，我们最终不得不做大量的小改动。测试允许我们做出那些改变，并确保我们没有破坏任何东西。也就是说，这完全取决于测试的价值。在某些情况下，测试可能很难编写，并且会变得不方便。如果你不得不对你的软件栈进行快速的修改，那么对所有东西进行测试会变得更加困难，并且维护这些测试会非常困难。例如，我以前工作的地方更加强调测试，因为软件变化不是很快。但是另一方面，我们也不能很快得到反馈。所以，我们在测试上下了很大功夫。然而在我现在工作的地方，软件变化非常快，我们很快就能从用户那里得到反馈。

***克里斯念:***

我认为在 TDD(测试驱动开发) 和 BDD 中对我来说重要的是它们帮助你找到 Aslak 所说的平衡。你需要考虑*如何*测试你的代码，还要考虑*在哪里*进行测试有助于高质量代码的发展。当你在测试中取得平衡时，你将能够非常容易地测试你需要的重要部分。例如，如果你正在向别人提供一个 web 服务，那么考虑人们将如何使用这个 web 服务就变得非常容易和简单了。像 Cucumber 这样的框架可以帮助你设计一个好的 web 服务，因为这个服务的第一个客户就是你的测试。说到平衡，考虑一下你是否真的需要测试每一页的背景色都是绿色的。可能你不知道。这些是你在平衡测试时需要考虑的事情。

**测试驱动开发和行为驱动开发有什么区别？**

***无级海勒罗伊***

大约五年后，作为对 TDD 的回应，BDD 出现了，因为人们很难学习 TDD。我认为 BDD 是对 TDD 的一些补充和改进。BDD 增加了对你如何谈论你的测试以及如何命名它们的调整；还包括编写它们所需的理解水平以及谁能编写它们。BDD 在过去的六、七年中不断发展；八年了，我想是从 2003 年开始的。所以现在，BDD 对我来说更多的是利益相关者、测试人员、程序员和用户之间的交流。

持续集成和测试 如何在快速发展的网络环境中发挥作用；使用它总是有意义吗？

***无级海勒罗伊***

我们一天多次收到对代码进行修改的请求，我们一天多次进行修改，一天多次进行部署。在那种快速变化的环境中，您并不真正需要可执行的规范，因为您有其他的反馈机制来代替 BDD 或可执行的规范所要解决的问题。但这并不意味着可执行的规范或 BDD 或 cumber 或其他什么不重要；这真的取决于你所处的环境。

***克里斯念:***

归根结底，首先为什么要编写测试？我们编写它们是因为我们相信持续集成。什么是持续集成？持续集成是一种反馈，即我正在做的事情(a)是业务所需要的，所以它是用户所需要的功能，而且(b)我正在编写的代码不会破坏任何其他已存在的功能。我们编写测试来加强和确保这种情况不会发生，并且测试提供反馈。持续集成的要点是在一定长度的开发周期内向开发人员提供反馈周期。重要的是反馈，而不是你如何得到反馈。因此，在缓慢移动的环境中，单元测试或黄瓜测试——无论您有什么不同的测试框架——这些都是提供大部分反馈的机制。我们现在所处环境的不同之处在于，我们可以更快地获得反馈，因为我们处于一个非常小的利基市场，终端用户数量非常少。与编写测试相比，通过部署到产品中并直接从用户那里获得反馈，我们可以更快、更有效地获得反馈。对我们来说，把它放在用户面前更快，他们会说，“哦，我需要调整字体，我需要改变这个单元格的背景颜色，请。”对于开发人员来说，处理它并将其推向生产可能比花费额外的时间编写测试来获得反馈周期更快。

我确实意识到，你知道，许多公司和大多数产品都不是那样工作的。这就是为什么我认为 BDD 提供了更多的可执行规范。我认为它提供了很多价值，仅仅是因为当你不能快速工作并接近最终用户时，你需要一些其他类型的交流和获得反馈的方法，在这种情况下，像 Cucumber 这样的 BDD 框架是有意义的。

运营和开发都可以编写测试，使用 cumber 这样的东西，任何人都可以编写测试。你认为测试是如何随着 DevOps 运动 发展的吗？

***无级海勒罗伊***

在我之前工作的地方，我的一些同事在为挪威国家乳品厂或类似的项目使用黄瓜，那是一个奶牛饲养组织。测试他们的软件实际上相当复杂，因为不同的奶牛需要不同的喂食程序，等等。还有复杂的业务规则，他们正在编写一个系统，需要以某种方式捕获所有的业务规则。他们培训了一个主要的专家，他不是程序员。她是一个快 50 岁的商业用户，他们训练她描述软件应该如何工作，实际上，在 Cucumber 中，她只是坐下来写。她写的东西，开发人员会在她描述更多业务规则的特性时实现。训练她非常容易，因为这个工具(Cucumber)是完全为不一定是程序员的人设计的。所以，我认为教非技术人员编写可执行的规范对很多团队来说非常有效。

***克里斯念:***

Cucumber-Nagios 的全部意义在于，如果 web 应用程序是用 Cucumber 编写的，就从 web 应用程序中提取一些最终验收测试，然后在生产系统中运行这些测试(使用 Nagios ),这样测试就定义了监视器。因为它们现在实际上在生产系统中运行，所以您知道生产系统是健康的。如果它不正常，测试就会失败并生成警报，告诉您生产系统有问题。这只是整个测试驱动基础设施的一个模型。因此，你可以借鉴开发人员多年来的做法，他们已经得到了自己的代码，并对其进行了测试。现在，他们有了测试和开发代码的方法，我们正在将它们应用到运营中。一旦我们拥有了基础设施，并将基础设施视为代码，我们可以做的就是编写测试来描述基础设施需要的外观，然后对基础设施进行更改，直到这些测试通过，然后告诉我们我们的基础设施是健康的。

Santiago Suarez Ordoñ ez 的自动化 Web 测试

Web 测试可能是由负责给定应用程序的开发人员编写的，或者可能是由一个完全不同的工程师编写的，他的角色是编写功能测试。像 Selenium testing framework([seleniumhq.org](http://seleniumhq.org))这样的工具甚至可以被运营部门用来自动化真实浏览器的监控或测试。主要的一点是，与使用仅发起 HTTP 请求而不在浏览器中解析和呈现 JavaScript 的代码的合成测试相比，使用真实的浏览器测试 web 应用程序提高了 Web 测试的准确性和真实性。人们使用 web 浏览器，所以没有浏览器的测试不会产生最准确的结果

Santiago Suarez oroez 是 Sauce Labs 的软件工程师，Sauce Labs 是 Selenium 测试框架的发起组织。Selenium 允许测试人员使用真实的浏览器开发测试用例，然后可以在真实的浏览器上重放，以模拟测试自动化过程中的实际使用。Santiago 给出了他们在软件开发周期中如何执行 Web 测试的例子。

你看到开发人员编写他们自己的 Selenium 测试了吗，或者主要是 QA？

幸运的是，大多数时候我看到构建主应用程序的开发人员实际上在为它编写测试，从生产率的角度来看，这绝对是正确的做法。在其他情况下，人们专攻某一领域，并获得自己的“自动化工程师”头衔。只要保持与项目开发的紧密联系，这并不是一件坏事。

您看到运营部门使用他们自己的硒测试吗？

我偶尔会这么做。人们使用真正的浏览器进行主动监控，测试 Flex/Flash 应用，完成没有它就不可能完成的任务。

你认为 Selenium 是验收测试驱动开发的一部分吗？

我认为 Selenium 应该是每个测试周期的一部分，从第一轮测试，到验收和后期部署。在我看来，理想的测试套件应该由各种测试组成，从单元级测试到功能和端到端浏览器测试。让我们也不要忘记最后的基本布局和整体质量的人工检查。

每种类型的测试次数应该与特异性水平成正比:对于单元级测试，应该有吨；对于功能测试，几个；对于端到端/集成测试，相当多；对于手动测试，基本的 3 或 5 个工作流贯穿 80 %的 Web 应用程序。

作为测试实践的安全性

安全性是 web 应用程序测试中经常被忽视的一个方面，但它是至关重要的。它经常被认为是测试中令人讨厌或不必要的部分，但这是不正确的。通过将漏洞测试集成到测试和持续集成周期中，您不仅会发现安全漏洞，还会发现性能问题、功能问题和意想不到的错误，否则这些问题可能永远不会被检测到，甚至在应用程序的生产使用过程中也会被检测到。

对 web 应用程序进行安全性测试可能会发现一些问题，而这些问题在实际的客户与应用程序或网站的交互中是无法发现的。测试通常涉及集成框架，如各种开放 Web 应用程序安全项目(OWASP)框架、Metasploit 或 Web 应用程序攻击和审计框架(w3af)。

这种框架除了揭示安全漏洞之外，还揭示了性能问题、缺陷和其他问题。通过将安全性测试集成到测试过程中，您可以获得额外的质量保证。

决定在哪里测试

在哪里测试取决于 web 应用程序当前在软件开发生命周期中的位置。在早期开发阶段，您可能希望直接测试堆栈的各个部分，以便更好地理解每个组件的性能。之所以如此，是因为在 web 应用程序中，web 堆栈的许多层在向最终用户提供页面或结果的过程中扮演着重要角色。该过程通常包括以下几层:

*   前端 ，浏览器中呈现 HTML、CSS、JavaScript 的地方。
*   Web 层 ，通常是管理通过 HTTP 访问 Web 应用的 Web 服务器。
*   应用层 ，可以由应用层的若干层组成，服务于各种业务逻辑功能。
*   数据层 (或数据库层)，从某种数据存储中检索实际数据:

*   关系数据库
*   键/值存储
*   面向文档的数据库
*   数据处理平台，如 Apache Hadoop
*   搜索服务器，如 Apache Solr

在项目开始时，单独测试这些不同的层可能会很有成效，尤其是在对堆栈的任何组件进行重大更改时。由于潜在的性能差异，在未来查明问题变得更加容易；该问题甚至可能存在于最终用户级别(用户的浏览器请求)。如果没有针对每个组件的基准测试，故障排除会更加耗时，因为当性能和功能出现问题时，您可能会发现自己要搜索整个 web 堆栈才能找到问题的根源。

度量标准 符合测试:决定测试什么

测试模拟某种活动，为构建 web 应用程序的团队提供信息——度量——关于应用程序将如何运行或历史上如何运行。这些度量标准通常是定量评估:显示应用程序或支持应用程序的系统的特定方面或组件在使用期间(即测试期间)如何执行*的测量、仪器和仪表。在一个 web 应用程序中，可能有数百甚至数千个不同的度量，所有这些度量都可能与特定的测试无关。例如，这些指标可能是为测量 web 应用程序指标而设计的固定监控系统的一部分，也可能是专门测量 web 应用程序响应时间的测试工具的一部分。*

指标和总结它们的仪表板对性能至关重要。绩效指标最终是由业务驱动的，尽管开发和运营有他们自己的一套关键指标。唯一“重要”的指标是那些与拥有软件的企业和使用网站或应用程序的用户相关的指标。

开发人员知道 web 应用程序应该如何在这些不同的关键级别上运行。除非他们共享这些信息，否则运营部门不会清楚地知道需要持续监控哪些指标。运营团队倾向于监控尽可能多的功能，假设他们将来可能需要这些细节。对于跟踪网站及其支持应用程序的性能来说，这并不是真正的好做法，因为它添加了大量无用的数据，应该限制在一组关键的指标上。

网站的业务指标

软件开发通常是一项昂贵的工作，因此任何大型 web 项目的主要目标之一是创收和提供服务。一个 web 开发项目必须在财务上是可持续的，否则它不会成功。它必须吸收至少与创建和维护项目所花费的一样多的钱。鉴于这一需求，被监控的最重要的度量将是业务度量。

企业所有者和高级管理层需要了解网站如何运作，因为这与他们的业务目标有关。他们主要关心诸如利润、运营费用、业务增长和客户对网上业务的看法等概念。大多数企业主和高管都全神贯注于这些问题，而对网络基础设施 如何工作的细节或寻找健康的衡量标准不感兴趣。他们也不应该如此，因为在经营企业的过程中，他们要处理的事情已经够多了。

相比之下，开发人员和操作工程师必须绝对关心对业务重要的事情。他们的责任是与业务所有者和管理人员合作，以确定在业务指标方面什么是重要的。他们还必须传达哪些技术指标 将提供数据来回答高管可能提出的关于业务表现的问题。

对于拥有通过广告或电子商务开展业务的大型网站的组织，或者其主要收入来源是通过与网站的交互的组织，最值得关注的问题之一是网页加载时间 。支持这一观点的一个著名指标来自 Amazon.comT2 的 Greg Linden，他假设 100 毫秒的加载时间增加会导致 Amazon.comT4 的销售额下降 1%。当然，网页加载时间不会对所有企业的收入产生如此巨大的影响，但很明显，当收入的主要来源是网站时，增加的加载时间会影响收入。

确定哪些指标对您的组织是重要的，需要开发人员和操作人员与业务所有者或高管会面，以确定哪些指标与最终的业务目标相关。以下是一些可以放入业务环境中的常见性能指标:

*   页面加载时间:将网站的页面加载时间与平均收入联系起来，有助于理解网站性能如何影响销售。
*   逐页的转换率 :找出哪些页面促进了期望的响应或在网站上产生了最多的收入，这对于了解你的网站是否符合你的商业目标是有用的。
*   功耗 :这个指标告诉你为你的网站提供服务所需的电力成本。一些代码发布实际上可能导致更高的 CPU 使用率，这意味着更多的功率利用和更高的成本。
*   内容交付网络带宽利用率:通过图表显示 CDN 上的带宽使用情况以及这在成本方面的意义，可以清楚地了解价值，并可用于与 CDN 的每月账单进行比较。

指标应包含在由技术团队准备的易于使用的仪表板中，供业务部门自助使用。业务人员不应该向技术团队请求一致同意的度量标准。这些指标应该按需提供，并定期验证其准确性，因为在指标报告中确实会出现错误。

性能测试是发布新应用的关键部分。在从最终用户的角度对软件进行彻底测试之前，软件工程和运营部门对于他们的应用程序在不同的负载场景下(也就是说，当用户对应用程序施加压力时)如何工作只能有一个有限的了解。

执行性能测试不是质量保证(QA)部门的责任，尽管一旦 web 应用程序交付给 QA 进行测试，QA 可能会运行自己的性能测试基准和套件。性能测试是运营和开发部门的责任，他们需要不断地测试性能；软件工程师需要使用微基准进行测试，运营部门需要开发并提供执行这些测试的工具。

对于被许多用户访问的生产网站，从真实客户的角度而不是从合成工具的角度衡量网站表现的唯一方法是使用真实的浏览器，从不同的互联网服务提供商，从全国或全球的不同位置，根据您的市场来监控网站。例如，如果您只在美国开展业务，并且您的网站是英文的，那么从美国的不同角落而不是整个世界监控您的网站的性能和可用性是有意义的。客户推动着业务的发展，准确地了解您的网站如何运行和被访问对于业务的成功运营至关重要。

在全国或全球范围内建立一个监控基础设施来跟踪网站的性能，并对其性能进行监控和报告，这是一件复杂而昂贵的事情，除了像脸书和谷歌这样的大型组织，这可能是令人望而却步的。一个组织必须首先开发一个监控基础设施来实现这一点，然后在全国或全世界的数据中心部署节点，并管理和维护该系统，这可能需要与管理和维护核心 Web 业务一样多或更多的工作。有许多第三方服务将此功能作为服务来执行，拥有这样的服务以真正了解一个组织的网站在公共互联网上的表现是至关重要的。Web 开发人员需要了解客户对网站性能的体验如何影响业务，以便他们可以与业务人员交流，共同确定哪些技术指标对企业的创收网站最重要。

Keynote Systems([keynote.com](http://keynote.com))的绩效咨询总监本·拉什洛(Ben Rushlo)与许多通过网站创收的大型国内和跨国企业合作。他描述了他认为企业应该关注的指标。

跟踪哪些网络指标很重要？

客户体验是最重要的指标。我为 Keynote 工作了 13 年，发现企业在跟踪与客户体验不直接相关的指标；他们可能有一些内部服务器指标或一些其他方式来显示他们做得很好，而实际上客户可能正在受苦。

所有的业务人员都在跟踪转化率和点击率，但是当我们开始说他们真的应该像考虑任何其他业务指标一样考虑性能时，他们有点奇怪。

我们试图鼓励商业人士根据他们所在行业的背景来这样做，并利用研究和最佳实践来提出一些合理的绩效指标。很多时候，这些指标与页面加载时间有关。这是我们肯定会考虑的事情。我们会检查它们的可变性，因为平均值可能会非常误导人。我们也看看交互需要多长时间，这是现在业界的一个相关话题，或者是首次渲染的时间。例如，我们会尝试评估客户的体验，比如“我能在网上买东西吗？”或者“我能造一辆车吗？”或者该网站打算做的任何事情。

主要的衡量标准应该是确定客户是否得到了他们期望的体验。然后我们是否能够完成我们的任何商业目标——转化或营销或其他。

Web 应用性能指标

在应用程序和系统级别测量的指标将根据 web 基础设施中的应用程序和系统类型而有所不同。要记住的要点是，只跟踪绝对关键的性能指标并确定其趋势。稍后添加详细的应用程序指标要容易得多，而不是试图筛选大量仪表板来找到当时重要的特定指标。不过，首先，您可能希望采用一种策略，在持续的基础上监控比平时更多的指标，并逐渐将监控的内容缩减到最基本的内容。对于一个新的项目，监控所有的或者大量的应用度量标准可能是谨慎的。当启动一个新的应用程序时，信息可能隐藏在不常用的指标中，否则您可能不会注意到。一旦您对整套指标进行了几个月的监控，很可能就会清楚哪些指标是有用的，哪些指标提供的价值很小或没有价值。

性能控制面板是在测量级别跟踪给定应用程序或系统指标的监视器。大多数应用程序通过一个 API 或工具来公开一些关于它们内部性能的信息。应用程序性能指标通常通过一些方法来访问，包括 SNMP、Apache Web 服务器的 mod_stats、Java 的 Java 管理扩展(JMX)、Ruby on Rails 的 rails_metrics gem、Erlang 应用程序的 emetric 以及 PHP 的 xdebug 或 dtrace(基本上可以与任何东西一起使用)。

通过指标配置文件将应用性能指标监控 付诸实践

假设我想监控一个 Java 应用服务器，它驱动一个运行电子商务网站[example.com](http://example.com)的 web 应用程序。example.com[的主要功能是销售任何类型产品的购物车应用程序。第一步是确定用户与网站的交互，然后随着时间的推移监视和跟踪这类应用程序可能出现的最常见问题。例如，我知道由于 Java 执行的方式，内存的使用可能很棘手。假设这是一个内存密集型应用程序，那么我肯定希望将 Java 内存堆包含在受监控指标的列表中。此外，因为这是应用程序的新版本，我将包括我在生产中通常不监控的指标，以查看是否有任何有价值的信息。一旦我使用这个指标配置文件一个月左右，就可以清楚地看到哪些指标需要继续监控，因为它们对故障排除很有价值。以下是我将采取的基本步骤:](http://example.com)

1.确定感兴趣的指标。在这种情况下，我要监控的初始详细指标集来自我的应用程序的可用指标列表，如下所示:

*   接收的字节数
*   字节数
*   要求计数
*   错误计数
*   加载时间
*   处理时间
*   最大时间
*   缓存大小
*   堆内存存储
*   当前线程繁忙
*   currentThreadCount
*   线程积压
*   最大线程数
*   线程优先级
*   集体主义
*   集合计数
*   OpenFileDescriptorCount
*   CommittedVirtualMemorySize
*   TotalSwapSpaceSize
*   自由交换空间大小
*   ProcessCpuTime
*   系统负载平均值
*   CurrentThreadCpuTime

2.在对这些应用程序指标进行了一段时间的监控之后，我获得了大量关于我的应用程序性能的信息，这些信息是在各种场景和负载量中收集的。现在，我可以使用这个监控配置文件将应用程序投入生产了。

3.在使用详细监控配置文件将应用程序投入生产后，我决定只需要以下指标，因为其他指标不会产生任何关于我的应用程序性能的有用信息:

*   要求计数
*   错误计数
*   加载时间
*   堆内存存储
*   当前线程繁忙
*   currentThreadCount
*   CommittedVirtualMemorySize
*   TotalSwapSpaceSize
*   自由交换空间大小
*   ProcessCpuTime
*   系统负载平均值

![image](images/sq.jpg) **注意**在测试期间对应用程序进行详细监控之后，监控哪些指标将变得更加明显。任何给定的组织决定监视什么将基于不同的测试场景，并最终看到哪些信息产生对应用程序性能的有用见解，并在故障期间提供故障排除帮助。在此生产测试完成之前，开发运维组织很难说出要监控的相关指标，除非它已经拥有关于给定应用程序或应用程序类型如何执行和运行的数据。

测试电池组的单个组件以便快速排除故障

对于任何网站来说，测试前端层都需要模拟一个真实的用户在网站上执行真实的功能。这被称为真实浏览器测试，它不同于使用 Apache-Bench 或 Jmeter 等工具模拟网站前端流量负载的综合测试。真正的浏览器需要花费一定的时间来组装文档对象模型(DOM ),包括解析 JavaScript，然后呈现页面。像 Apache-Bench 和 Jmeter 这样的工具不会测试真实浏览器加载的这些方面。

有许多工具可以在网站上以编程方式配置和执行真实浏览器测试，这些测试可以自动化并集成到 QA 和持续集成流程中。我前面提到的 Selenium 是一个 web 应用程序测试系统，包括对大多数主流浏览器的支持，Watir ( `http://watir.com`)代表 Ruby 中的 Web 应用程序测试，是一个 Ruby gem 库，可以自动执行 Web 浏览器测试操作。

直接测试 web 层更像是一个综合测试，它让您知道将支持多少个会话，尽管它对于理解应用程序对最终用户的行为没有太大价值。Apache Bench 和 Jmeter 等综合测试可用于现场测试和冒烟测试以及性能测试，非常适合进行简单的测试，例如在 Apache web 服务器上调优 KeepAlive 变量，以及其他 web 服务器调优练习，但不应该依赖 Selenium 或 Watir 提供的最终用户性能指标。这里要记住的主要思想是，在模拟某种用户活动(比如加载相册)的受控环境中执行的测试，不会像在生产环境中那样执行。尽管在试运行环境中进行的测试会揭示应用程序的许多性能或行为，但只有在应用程序投入生产后，它的真实性能和行为才会显露出来。

Selenium 是一个使用真实浏览器进行自动功能 web 应用程序测试的框架。它允许您在网站上配置工作流和交互，模拟真实用户的行为。Selenium 还将这种交互记录在视频中，因此您可以稍后返回查看测试是通过还是失败。由于启动真实浏览器、记录交互和重复该动作所涉及的开销，该过程将需要数百或数千个虚拟机来模拟数百或数千个用户使用真实浏览器访问站点的同时负载，这对于即使是大型组织也难以实现。有一些服务可以执行这种活动，并且在世界各地都有节点，比如 Keynote Systems、Gomez 和 BrowserMob(使用 Selenium)，所有这些服务都使用真正的浏览器进行地理上分布的负载测试和性能监控。

测试 web 堆栈的所有组件，不管是如何完成的，都是至关重要的，一旦您为 web 应用程序堆栈的每个部分建立了记录，并且记录了各个层在一段时间内的行为，这将更加有益，因此可以将它与 web 堆栈中的发布或更改进行比较。

逐层保存历史性能数据

拥有组成 web 堆栈的每一层的历史性能数据对于在出现问题时快速确定位置至关重要。典型的三层架构包括 web 层、应用层和数据层，其中任何一层都可能出现性能问题，通常很难确定问题所在。通过保存每一层的性能数据，通常可以在最终用户注意到问题之前，或者更重要的是，在问题影响到站点或应用程序的创收功能之前，检测并解决问题。Web 开发人员需要与运营部门协同工作，以获得对每一层的可见性，尽管确定如何测试每一层可能是两个团队的责任。例如，web 开发人员可能是在应用程序层和 web 层保存历史性能趋势数据的人，他们对如何测试这些层以及这些层中的测试内容有更多的发言权。另一方面，对于数据库层，可能是数据库管理员设置一个工具或测试来执行数据库的某些查询和功能。

对于任何通过网站产生收入或销售线索的企业来说，监控最终用户的表现是绝对重要的。不知道网站在国家或全球层面上的表现会使企业缺乏管理其核心业务的洞察力。但是，如果您希望能够快速有效地诊断问题，并对影响最终用户性能的各个层或组件进行更多控制，仅仅监控最终用户性能是不够的。

图 3-1 显示了一个典型的三层 web 环境，该环境有一个全球或地区性的性能监控服务，因此企业可以跟踪最终用户和 Web 性能指标。在逐层的基础上，对 web 堆栈的各个组件只有最低限度的监控或根本没有监控，并且当使用全球监控服务在最终用户级别检测到问题时，开发和运营团队必须打乱和搜索日志以找出性能问题所在。在此示例中，当做出影响所有三个层的更改时，终端用户的性能会下降。

![9781430239697_Fig04-01.jpg](images/9781430239697_Fig04-01.jpg)

[图 3-1](#_Fig1) 。*仅监控高级指标*

事实上，问题可能是由外部因素引起的，如 DDoS 攻击、网络或 ISP 问题，或者网站访问者的突然增加。但是，因为没有关于每一层的历史表现的数据，所以要确定问题的根源会更加困难，需要更多的时间和协作。

[图 3-2](#Fig2) 显示了相同的环境，其中每个层*现在都有历史性能数据。*在这种情况下，如果内部更改导致最终用户性能下降或出现问题，几乎可以立即检测出来。解决问题所需的时间显著减少，因为现在可以在更精细的级别检测性能变化，并且确定问题发生的位置将被隔离到一个特定的层。可以将这些性能数据与变更日志和应用程序日志文件进行比较，并且几乎消除了隔离问题位置的困难。此外，当最终用户遇到性能下降时，确定重要因素是内部还是外部的工作现在已经从手动操作减少到简单地浏览几个历史性能图表。

![9781430239697_Fig04-02.jpg](images/9781430239697_Fig04-02.jpg)

[图 3-2](#_Fig2) 。*在逐层的基础上保持对历史数据的跟踪，可以更容易地查明网络堆栈中的问题*

摘要

知道在实现任何类型的测试方法时要寻找什么，对于产生高质量的结果和改进软件是至关重要的。第一步是理解业务的性质，以及什么样的指标提供最大的价值。这是设置、调度和分配测试资源的关键，也是了解哪些测试用例将产生最大价值并节省最多时间的关键。理想情况下，所有软件都应该被彻底测试，但即使如此，在实施测试计划和决定方法之前，了解被测试应用程序的具体指标和特性将有助于保持对期望结果的关注。简单地测试一切只是浪费时间和金钱，而且适得其反。

维护测试阶段和周期的历史数据，并定期逐层审查测试结果，以及从整个网站的最终用户体验的角度(运用整个堆栈)来看，将有助于减少识别和查明出现的任何问题所需的时间。

[<sup>1</sup>](#_Fn1) 统计数据来源于格雷格·林登的演讲《让数据有用》([http://sites . Google . com/site/glinden/Home/stanforddataming . 2006-11-28 . PPT](http://sites.google.com/site/glinden/Home/StanfordDataMining.2006-11-28.ppt))，于 2011 年 7 月 15 日查阅。