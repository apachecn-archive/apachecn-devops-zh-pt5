第
章 4

设计智能文档

大多数组织忽视了文档的价值及其在加速和提高应用程序质量和操作团队效率中的作用。文档通常被视为减慢 Web 开发的东西。然而，如果明智地使用，它可以成为提高代码质量、操作过程和信息技术团队整体效率的强大工具。

文档是软件开发生命周期的关键部分。它与测试和质量保证同样重要。如果您不能清楚地说明您的应用程序或操作过程是如何工作的，或者其他人如何能够复制您所采取的步骤，其他工程师将会发现配置、构建和复制软件是很困难的。此外，在你让别人完成你记录的步骤之前，你不会发现错误或完全没有意义的部分。

文档实际上提高了输出的效率和质量，因为每个人，不仅仅是技术团队，都清楚地知道应用程序的过程、架构和用户体验是如何联系在一起的。

在这一章中，我们将看看如何创建记录流程。与此同时，我们将在 Web 开发和运营团队中提出一种文化转变，这将缓解这样一种看法，即花时间编写文档比花时间编写代码更好。

文档带来的看不见的好处

一旦文档文化被逐渐引入到一个网络组织中，它就会成为其他人依赖的一种实践。一个显著的优势是，当员工在流失过程中发生变化时，良好的文档记录可以更容易地引入新的开发和操作人员，而不必投入大量的“指导”时间。这也是审查的另一种形式，在标准代码注释、错误跟踪和源代码控制过程之外，它们构成了软件开发的通常路径。文档在生产专有软件的组织中尤其重要，在这种情况下，新来者很难理解复杂的定制应用程序，以及它们如何组合在一起以构建消费者眼中的网站。如果文档成为过程中不可分割的一部分，交流软件是如何构建的将会可靠地发生，工程师将会习惯于向其他团队成员描述软件是如何工作的。

要看到这一点，只需考虑最成功的开源软件，它们往往有某些共同点:一个蓬勃发展的开发人员自由协作和交流的社区，以及优秀的文档。当开发人员协作为各种各样的受众制作优秀的文档时，构建和管理软件就变得容易多了。这适用于所有组织，对于大型组织尤其重要。

在本章的后面，我们将检查各种创建标准文档的模板，这些模板将帮助您学习如何管理组织内部构建的软件。例如，一个高级软件开发人员可能只需要使用 API 规范和参考就可以开始实现一个应用程序，而不需要阅读其余的文档。另一方面，入门指南以简单的方式提供了更多的信息，将帮助初级软件开发人员快速了解他们需要使用的应用程序、平台或库。用例文档向非技术人员解释特定应用程序的用途。我们稍后将更详细地查看这些模板和其他模板。

有了这些现成的信息，理解复杂的 Web 和应用程序架构所需的时间将会大大减少。如果没有一套完整的文档来说明给定技术如何工作的各种观点，Web 开发人员和操作工程师就只能靠自己去弄清楚事情是如何工作的。

最重要的是，各种涉众对文档的实际书写将会带来看不见的问题和改进的机会。例如，当工程师开始在纸上或设计模型中绘制 Web 应用程序，以便其他人可以很容易地理解这个概念时，结果是关于应用程序的技术能力和设计的更好的反馈。面向各种读者的文档也是有益的。业务用户很可能无法理解 API 规范，但是创建一个简单的图表来说明复杂的 API 或应用程序如何相互交互将会对非技术受众有所帮助。这样的文档也可以让初级工程人员更容易理解复杂的软件架构。

在这方面，文档成为一种活的反馈机制。它成为将应用程序转换成文字和可视化的管道，比您必须费力地通过代码或实现应用程序要快得多。编写和使用文档是一种获得反馈、发现代码中的问题以及为应用程序和过程设计产生新想法的机制；实际上，它是在测试你的代码和 Web 应用程序。

文档障碍

让开发人员和工程师编写文档可能特别困难，所以理解他们为什么不这样做是有帮助的。一旦您理解了阻止人们将文档集成到开发过程中的一些常见障碍，您将会对如何解决那些阻止他们在他们生产的应用程序和 Web 产品中实现最大效率和质量的常见场景有一个更好的想法。以下场景代表了工程师为避免编写文档而提供的一些借口。

场景 1:时间不够了

最好的 Web 开发人员总是编写注释良好、文档完备的代码，但即使是他们也通常不会为非开发人员编写文档。最好的工程师会疯狂地创建应用程序，而不想花时间写出来或向别人解释。他们可能认为代码就是文档，有技术能力的人能够理解代码，所以编写额外的文档是浪费时间。

然而，现实是，并不是每个人都讲 API 或配置管理清单。业务用户、项目经理和其他非技术人员通常需要理解应用程序的内部工作方式，这样他们才能更好地完成工作，而技术文档是行不通的。这些辅助人员对于 IT 组织的正常运作至关重要，他们可能会感到疏远，不确定如何与开发和运营团队互动，或者如何向业务部门、项目管理部门或其他技术含量较低的部门的其他人展示他们的工作。

此外，软件开发的速度越来越快，这意味着开发人员和运营人员需要比以往任何时候都更快地进行生产，而交叉培训他人、编写文档和自己接受培训的时间越来越少。这是一个错误。如果您不编制文档，您将会把遗留系统引入到您的组织中。遗留系统通常需要每隔几年更换一次，因为知道如何维护它们的人要么已经离开了组织，要么根本不记得如何维护系统，也没有可以依靠的参考资料。

解决方案:将文档构建到成功标准中，并分担文档的责任

大多数基于 Web 的组织使用某种敏捷或精益的过程来生产他们的软件，并且该过程通常包括对已经完成的工作的定期评审，以及检查任务以确定项目的进展情况。文档应该是成功标准的一部分。通过这样做，文档被集成到开发和操作团队的文化中，组织将获得好处，例如更好的代码和暴露设计中的缺陷。

这个过程需要管理层的认同才能成功。如果管理层仅仅专注于满足最后期限，而不是创造一种文档文化，那么这样的命令是不可能成功的。简单地同意文档是软件开发生命周期的一部分，而不跟进必要的工具和时间来记录文档，这意味着集成文档文化的目标将会实现。

此外，开发和操作团队都必须参与到文档文化的建设中，这是一个团队的努力，而不是几个人的责任。在非常大的组织中，拥有一名具有开发或运营背景的全职技术作家可能会有所帮助。一个有技术背景的作家不太可能被看作是一个只会让工程师的生活更加艰难的人。

利益:责任

拥有一个技术作家有助于鼓励开发和操作团队负责记录他们自己的代码、应用程序和过程。一个有经验的技术作家可以指导那些不知道如何写有效的文档或者只是没有这样做的习惯的人。这可以帮助厌恶文档的工程师轻松地编写文档。

一旦个人拥有了自己的文档，技术作者就可以将角色从传播者和作者转变为编辑和指导者，负责确保文档的组织和可访问性，并帮助工程师提高他们的技术写作质量。当然，技术作家的职责在不同的商店会有所不同，这取决于网络业务是如何组织的，但是作为文档的关键人物，他或她可以帮助确保文档实际完成。

场景 2:只有技术文档

不是组织中的每个人都是高级软件工程师或系统管理员，只有基于规范的文档意味着只有高度技术化的人才能阅读它。这是导致功能障碍的原因，只有高级技术人员才能看到应用程序的运行情况。当然，拥有这些文档是很好的，也是必要的，这比简单地依靠挑选源代码来弄清楚应用程序发生了什么要好得多。然而，它不能作为一个完整的文档策略和文化。

解决方案:针对您的受众的文档

如何解释特定类型的文档取决于个人在组织中的位置。例如，一个 API 引用对系统管理员，甚至是高级系统管理员都没有价值。他们不太可能花时间去弄清楚一个 API 参考，甚至去问他们如何解释或使用 API 参考来改进他们的操作流程。相反，系统管理员需要的是考虑到系统管理员的上下文而编写的文档。这样的文档可以从 API 参考中继承很多信息，但是它不仅仅包含一个函数列表，还应该包括关于 API 可以服务多少个请求、它使用什么网络协议以及它可能需要的任何软件依赖性的信息。这使得系统管理员能够提供关于如何部署应用程序的信息，以及关于将在其中部署应用程序的服务器环境的任何警告和问题。在这种情况下，我们从一个 API 参考开始，然后为两个不同的受众提出了两个关于该 API 的*实现*的具体文档:一个是操作指南，一个是开发指南。

通过为各种各样的受众准备一套完整的文档，文档将成为团队文化的活的一部分。了解哪些人需要依赖文档是很重要的，比如业务用户、系统管理员、数据库管理员、软件开发人员、网络工程师、项目经理等等。对于商业用户来说，也许 API 规范需要考虑每个应用程序的支持成本；或者应用程序使用哪些协议。对于应该产生什么类型的文档，没有一个公式；这取决于业务和团队的需求。

好处:加强不同团队之间的联系

为各种各样的受众创建文档可以加深交易双方的理解，减少误解和错误，降低双方的压力水平。此外，文档可以从其他文档中构建。例如，一旦您获得了有关应用程序的功能和限制以及操作基础架构(服务器、网络设备等)的功能和限制的信息，您就可以将这些信息放入维护和容量规划成本以及可扩展性指标的上下文中。一个文档可以产生另一个文档，并且生成连续文档所需的时间减少了，因为每个文档类型都是建立在另一个之上的。这并不是在所有情况下都适用，但在很多情况下确实适用。

场景 3:文档很快就过时了

即使在拥有健壮的文档和健康的文档文化的组织中，应用程序的发展和变化也比文档快得多。一个简单的事实是，软件的移动速度比文档快得多，即使有了自动化的文档系统，有时你仍然需要一个人来写出文档供人们阅读，这种文档需要技术，并将其放入特定类型的读者可读的上下文中，不能用自动化的方法来维护。

API 引用和其他高度技术性的文档很可能会被自动记录为编程语言平台的一部分(Java 的 JavaDoc、Ruby 的 RDoc、Python 的 Pydoc 等等)。然而，需要人类表达的文档——最有价值的交流形式——不会像技术文档那样与应用程序和基础设施有密切的关系。因此，文档可能在短短一个月内就过时，在某些情况下甚至更短，有些文档可能几年都不会更新。这实际上比没有文档更糟糕，因为工程师可能认为他们有正确的信息，而实际上他们是在遵循过时的指令，而不是去询问信息。

此外，一旦创建了文档，许多工程师不会想到回去更新它。定期进行文档审查将有助于文档保持最新。

解决方案:通知工程师更新文档

不太可能有人会浏览整个组织的文档管理系统(如 wiki)中的所有文档，尽管在部门级别可能会进行一些删减和编辑。但是随机的方法是非常低效的；必须有某种机制，通过这种机制，文档管理系统通知所有者或管理员文档在规定的时间内没有更新。TWiki 开源维基提出了一个解决方案，页面应该像报纸一样变黄。此外，应该向文档所有者发送一封通知电子邮件，告知可能需要进行更新。 [<sup>1</sup>](#Fn1)

但是仅有工具是不够的。在操作和开发团队中必须有一个观念的转变，接受使用文档作为改进软件的工具。例如，一个需要更新的页面可以永远变黄，但这并不一定意味着有人会更新它。必须有对通知的响应，如果接收者不理解创建和维护文档以及代码和系统的价值，则可能不会有响应。但是如果工程人员意识到系统会在必要时通知他们更新文档，并且他们应该在收到通知时这样做，他们就更有可能坚持到底。这听起来可能微不足道，但是简单地让工程师意识到这一点将鼓励他们对文档认真负责。

好处:文档被整合到常规活动中

当开发人员习惯于接收关于必要更新的通知并对其做出响应时，他们将开始看到文档在改进其软件方面的价值，这将鼓励他们进一步及时地对通知做出响应。

文档类型和模板

文档的类型及其结构因组织而异。当您遵循一个模板时，创建文档实质上就变成了简单地填写一个表单。(这不是视觉辅助工具的情况，比如图表。这些也可以自动化，但是工作量很大。)模板使工程师更容易更多地参与到过程中，因为他们不再需要弄清楚要写什么以及如何格式化它。模板结构还使其他应用程序和自动化流程更容易使用文档管理系统或 wiki 中的信息，例如，将要构建的服务器列表转换为配置管理文件，反之亦然。记住，模板应该是灵活的，能够根据你的需要改变它们的用途。

以下是一些常见的文档模板类型,可以帮助开发人员和运营工程师更高效地编写文档:

*   API 规范和参考
*   入门指南
*   用例文档
*   用户交互工作流
*   架构图
*   基础设施设计文件

下面几节将分别讨论这些问题。

![image](images/sq.jpg) **注意**下面讨论的文档类型主要取自开源框架，尽管这里的重点只是简单地说明一种文档类型。

API 规范和参考文献

API 规范通常设计得很简洁，主要是为了让应用程序开发人员知道他们可以在代码中实现什么功能。有些 API 参考比其他的要好；一个好的 API 参考不仅有关于函数调用的信息，它还显示了用普通语言编写的信息。

[图 4.1](#Fig1) 展示了一个写得很好的 API 引用。这是一篇冗长的参考文献的第一部分。有关完整参考，请参见`www.erlang.org/doc/man/gen_server.html`。

![9781430239697_Fig05-01.jpg](images/9781430239697_Fig05-01.jpg)

[图 4.1](#_Fig1) 。*来自[Erlang.org/Doc](http://Erlang.org/Doc)T5 的精心编写的 API 文档*

**好处**

*   软件工作原理的详细参考
*   作为软件内部工作的参考
*   允许扩展简洁的技术信息，也许解释一个方法做什么，以及可以传递给它的各种参数

**不利方面**

*   只解释了软件的一小部分
*   对于第一次使用该软件的人来说可能很难理解
*   非技术人员，如项目经理、业务管理人员和一些运营工程师，可能无法理解它。

入门指南

入门指南主要是为低级开发人员或操作工程师编写的，帮助他们熟悉新技术、平台或 API，以便他们能够快速开始使用。在一个设计良好的组织中，这种类型的文档可以由开发人员工作站来代替，开发人员工作站使用配置管理和开发人员工作站供应系统来设置，如 vagger、Chef 或 Puppet。然而，并不是所有的组织都使用这样的系统，有时开发人员更喜欢手动设置应用程序、系统或 API，以确保他们了解它是如何安装和配置的。在这种情况下，这些指南是非常宝贵的。

![image](images/sq.jpg) **注意**工具可以通过自动化来补充大量的文档过程。例如，如果您运行一个单独的流浪脚本来设置您的 dev box，您不需要一步一步的文档。

《入门指南》将高级开发人员从设置新的应用程序、系统或 API 的过程中解放出来，从而为所有相关人员节省时间并提高效率。一份精心编写的指南，例如图 4.2 所示的指南，可以让开发人员或操作工程师快速准备好并开始使用特定的技术。

![9781430239697_Fig05-02.jpg](images/9781430239697_Fig05-02.jpg)

[图 4.2](#_Fig2) 。 *jQuery 入门指南*

以下是本例中需要注意的一些事项:

*   作者:写文档或最后编辑文档的人的名字，以防有人需要与此人联系。许多好的文档系统也有一个修订历史，以便于找到特定页面的主题专家。
*   目录:可点击的目录列表使得导航更加容易。
*   正文:一步一步的说明展示了如何开始并运行一项给定的技术，以便开发人员或该技术的新手可以在短时间内开始使用它。工程师永远不应该通过询问他人或自己拼凑信息片段来填补空白，这不是对时间的有效利用。

利益

*   从未使用过该技术的人可以很快开始使用它或为它开发
*   允许快速介绍新的东西，这样你就可以开始工作了
*   充当学习更高级主题的踏脚石

用例文档

真正有用的文档不仅仅包括入门指南和 API 参考；它还将包含如何应用该技术的信息。用例文档提供了关于特定技术、API、平台或系统在特定业务环境中应该如何使用的详细信息和解释。

用例文档的示例如图 4.3 所示。这个例子展示了 Apache Hadoop，一个用于数据处理和 MapReduce 操作的开源库和平台，如何用于处理 Web 服务器日志或在 Amazon 的 EC2 云平台上运行 Hadoop 的 Hive 平台来执行数据仓库。 [<sup>2</sup>](#Fn2) 这个使用 Hive 在 EC2 上执行数据仓库的例子是针对那些出于商业智能目的而进行大量日志处理的开发人员和工程师的，并具体解释了如何在这种能力中使用该技术。

用例文档确实在一定程度上依赖于 API 参考和入门指南，因为通常最好在使用之前获得对技术的一般基础和理解，但是更有知识或缺乏耐心的开发人员可以通过首先检查用例文档来快速开始评估特定的应用程序或平台是否适合他。

![9781430239697_Fig05-03.jpg](images/9781430239697_Fig05-03.jpg)

[图 4.3](#_Fig3) 。*用例文档*

利益

用户将理解如何在特定场景或应用中实现特定技术，例如如何在云计算平台(例如亚马逊网络服务)上使用通用技术，例如上述案例中的 Hive / Hadoop。

用户交互工作流程

用户交互工作流图表示用户与网站或 Web 应用程序交互的流程，通常仅在设计新的 Web 应用程序或修改现有应用程序时使用。这些图表有助于规划用户(无论是网站访问者还是内部业务用户)如何从 Web 应用程序中获得期望的结果。[图 4.4](#Fig4) 展示了在电子商务 Web 应用程序中向购物车添加商品的功能，并显示了在这样做之后客户可以采取的路径，以达到购买产品的最终结果。

![9781430239697_Fig05-04.jpg](images/9781430239697_Fig05-04.jpg)

[图 4.4](#_Fig4) 。*一个用户交互工作流程图的例子*

利益

用户交互工作流程图清楚地显示了用户将如何与网站或应用程序交互，并描述了在应用程序中获得最终结果的所有可能路径。了解用户可以去哪些“检查点”以获得想要的结果，如阅读文章或查看购物车，将使运营人员更好地理解*网站如何*运行以及可以与网站交互的方式，这有助于从最终用户的角度排除意外行为。

架构图

架构图说明了一个复杂的 Web 应用程序的组件是如何排序和相互连接的。对于任何基于 Web 的组织来说，这都是一个关键的文档，因为如果没有这个可视化的地图，就很难掌握整个网站堆栈。相比之下，组成网站或 Web 服务的所有组件的图更容易理解所有不同组件之间的关系，如 Web 层、应用层、系统基础结构、网络基础结构和数据层。即使是应用和平台的复杂排列，也可以用可视化格式快速简洁地表达出来，如图[图 4.5](#Fig5) 所示。

![9781430239697_Fig05-05.jpg](images/9781430239697_Fig05-05.jpg)

[图 4.5](#_Fig5) 。*一个基本的网站架构图*

如[图 4.5](#Fig5) 所示，即使你以前从未在这个特定的网络组织中工作过，你也可以从图表中很好地了解网络架构是如何配置和布局的。大型网站可能会有比这复杂得多的体系结构，包括许多 Web 和应用程序体系结构图，但即使是小型组织也应该至少有一个图表来描绘网站或应用程序的全貌。

利益

架构图在一个地图中总结了各种系统和应用程序的复杂交互，提供了复杂系统的各种组件如何协同工作的高级视图。这有助于新员工或那些以前没有参与过项目的人理解系统的整体以及组成系统的各个部分。这使得排除故障、维护和改进应用程序变得更加容易。

基础设施设计文件

基础设施设计文档代表构建将托管给定 Web 应用程序的系统基础设施所需的必要硬件、服务器和网络组件。基础设施设计可以从应用程序架构图中获得，反之亦然。通常，基础架构设计将包括服务器的主机名、它们的 IP 地址、操作系统以及安装在服务器上的任何应用程序。这种类型的文档允许 Web 开发和运营团队就构建托管网站或 Web 应用程序的环境所需的必要组件达成一致。建议使用模板来填写这些信息，并且大多数 wiki 系统都提供了模板系统，以便不同的组、开发、系统操作、网络操作、数据库管理或其他操作团队可以获得关于结构化格式中需要哪些组件的所有信息。因此，团队拥有构建 Web 堆栈所需的信息，这意味着需要更少的交互，并减少出错的机会。

此外，该结构化文档可以被转换或读取到诸如 Kickstart、Cobbler 或 Spacewalk 之类的供应系统以及诸如 Chef、Puppet、Cfengine 等之类的配置管理系统中，使得配置和供应可以自动化。根据组织的规模和复杂性，从文档到实际供应新服务器并向其部署代码所需的自动化程度会有所不同，但在大多数情况下，Web 堆栈或环境将包括哪些组件和配置细节的规范将在这样的文档中定义。

在[图 4.6](#Fig6) 中的简化示例中，您可以看到有一个将构成新 Web 应用程序的服务器场的名称，还有服务器名称、IP 地址、子网、负载平衡器和防火墙信息，以及一个应用程序服务器和将被部署到该特定环境中的应用程序服务器的代码。

![9781430239697_Fig05-06.jpg](images/9781430239697_Fig05-06.jpg)

[图 4.6](#_Fig6) 。*在 Atlassian Confluence 创建的基础设施设计文件*

利益

基础设施设计文档有助于描述各种自包含的 Web 应用服务器群，并且本质上是指示如何构建服务于 Web 应用或网站的功能环境的处方列表。此列表总结了组成网站所需的所有要素，包括网络、应用程序、数据库和软件配置信息，这些信息甚至可以由配置管理数据库和配置管理系统以自动或半自动的方式更新或使用。

自动化文档

通过不同程度的自动化，文档可以成为任何基于 Web 的组织或业务的活的一部分，并且自动化的程度将根据业务的规模、复杂性和需求而变化。如果您考虑前面讨论的不同文档类型，您可以看到信息被清楚地安排，并且将信息填充到文档中的方法会有所不同。例如，当我在基础设施设计文档中输入要部署 CustomWARFile1 时，Web 应用程序归档文件(与 Java Web 应用程序一起使用)中可能会有一些信息，我需要收集这些信息并将其放入文档中。我可以让我的 wiki 由我的构建和部署系统编写，这样当我推送我的代码的新版本时，我的代码部署工具有一个读取相关配置文件的过程，用版本信息和其他应用程序元数据更新它，然后将它推送到这个 wiki 页面。通过这种方式，非技术用户可以获得关于在这个特定 Web 环境中部署的应用程序的详细信息，而不必询问某人或知道如何访问源代码库或构建和部署工具的 changelog 历史。这一要求可能因组织而异，但文档可以通过与组织中的各种配置管理、源代码管理和部署工具集成的方式实现自动化，从而为那些关于 Web 环境配置细节的陈旧信息的死气沉沉的 wiki 页面带来新的生机。

摘要

文档是技术人员工作中经常被忽视的一个方面，让开发人员定期且一致地进行文档编制通常涉及到一种文化转变，因为这似乎经常是浪费时间，而这些时间本可以更好地用于生产宝贵的代码或维护系统。这是一个常见的谬误，当人们或团体花时间创建文档系统，然后在他们的公司内宣传该过程的好处时，这种谬误通常会消失。这是文档制作方式发生文化转变的时候，技术人员开始承担起责任，开始在整个组织中宣传制作好的文档，作为一种惯例。拥有支持系统和工具有助于克服许多工程师不愿意将这个看似耗时的过程集成到他们的日常工作中。

当开始在一家新公司工作时，开发人员或运营工程师可能会寻找许多相当标准的模板类型。有了这些模板，个人可以很快熟悉组成一个大型网站的各种应用程序、系统和网络基础设施细节的复杂性。各种模板使得熟悉新技术和程序变得更加容易，而不必打扰同事。模板使得遵循记录和描述如何管理软件或支持软件的过程的标准过程变得容易，并且有许多相当常见类型的文档和图表帮助描述和教育工程师如何安排复杂的软件和基础结构，以及它如何在内部工作以组成和支持复杂的网站。

[<sup>1</sup>](#_Fn1) 参见在 TWiki.org[的讨论](http://TWiki.org)([http://www.twiki.org/cgi-bin/view/Codev/ShowPageAgeVisually](http://www.twiki.org/cgi-bin/view/Codev/ShowPageAgeVisually))，访问于 2011 年 7 月 29 日。

[<sup>2</sup>](#_Fn2) 要查看完整用例，请前往 https://cwiki.apache.org/confluence/display/Hive/HiveAws。(图 6-3 于 2011 年 7 月 28 日获取。)