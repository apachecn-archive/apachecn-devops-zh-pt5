# 十四、前方的路

这是 DevOps 在微软堆栈上的最后一章。在这一章中，你将回顾你所学的内容。本章还介绍了我通常尝试向公司介绍 DevOps 所有不同组件的顺序。本章将帮助你想出一个适合你情况的计划。

## 基础知识

给一个组织引入变革是困难的。如果你已经阅读了这本书，并且想要开始实现其中的一些步骤，你将会在团队工作中面临挑战。我认为向组织引入敏捷、开发运维以及应用生命周期管理的最佳方式是通过实例。您可以展示可以实现什么，然后交付一个概念证明，表明这些原则可以应用于您的组织所从事的项目类型。如果有一个绿地项目即将到来，这通常是引入 DevOps 的好时机。但是绿地项目并不经常发生。如果你在做一个棕色地带的项目，挑战会更难，但不是不可克服的。你需要找到你和你的同事每天必须处理的最大的痛点。

您可以关注的一些问题包括:

*   重复出现的 bug 多吗？
*   规格是否清晰，每个人都知道要建造什么吗？
*   部署是手动完成的吗？这是否经常导致挫折和错误？
*   你的代码质量如何？你有很多技术债务吗？
*   开发者可以一起开发一个应用吗？当一个 bug 被归档时，是否有时在寻找代码的正确版本时会有问题？是否因为合并困难而损失了时间？
*   你们共享代码吗？项目之间有很多重复吗？代码是如何共享的？
*   你的测试人员什么时候开始在一个项目上工作——是在第一个版本发布之后还是之前？他们有自己的专业工具还是主要使用 Excel 和手工测试之类的东西？
*   您知道您的生产环境何时会出现问题吗？你能容易地诊断和分类失败吗？

你最了解你的情况，你可能会针对你的情况提出更多的问题。我注意到使用这种类型的问题经常会把问题暴露出来。

作为一种通用方法，我首先尝试实现以下组件:

*   版本控制
*   技术债务管理
*   连续累计

为什么是这三个？因为作为开发人员，我们可以实现这些功能，而不需要项目中其他团队的帮助。这都是技术性的，涉及代码。版本控制是绝对必须的。如果您仍在使用共享文件夹和复制/粘贴合并，请从版本控制开始。如果很难让你的开发伙伴相信版本控制的好处，那就从你自己使用它开始吧(或者另找工作)。Git 的分布式架构使得在您的机器上本地安装它并仅将其用作本地存储库变得非常容易。这使您可以拥有自己的更改历史，并轻松回滚到以前的版本或创建一个功能分支来做一些实验，而不必处理复制文件夹和恢复备份。

让别人对你的想法充满热情的关键是向他们展示这些想法是可行的。以身作则，不要空谈。只要你的同事没有看到实际的好处，以讨论某些特性是否对团队有益而告终的讨论通常是你会输掉的讨论。通过展示什么是可能的，试着让他们充满热情。本地 Git 存储库是一个很好的开始方式。

技术债务管理也是如此。运行作为 Visual Studio 一部分的分析工具来检查代码的整体质量是很容易做到的事情。也许你没有时间开始修复这些代码。如果这是真的，至少对你正在处理的新代码进行分析，并确保你没有引入任何新的技术债务。您甚至可以在您的开发机器上安装 SonarQube 的本地版本，并在您的项目上运行分析。

激发他人热情的最佳方式是，当一位注重视觉效果的同事甚至经理来访时，打开您电脑上的仪表盘。向他们展示什么是可能的，以及实现起来有多容易。为您正在编写的新代码添加单元测试也是一个很好的步骤。您甚至可以使用 IntelliTest 创建一个测试工具，允许您安全地重构代码，而不必担心会破坏任何东西。

持续集成稍微困难一些，因为您需要有版本控制，并且能够访问构建服务器。如果您可以激励您的团队迁移到 Visual Studio Team Services，那么您已经拥有了所有必需的资源。如果云是(还不是)一个选项，您也可以在内部安装 Team Foundation Server。您的 MSDN 订阅已经让您获得所需的许可证，使整个过程便宜得多。持续集成是交付管道的起点。如果设置完整的 Team Foundation Server 环境太难，可以在本地计算机上安装代理。当然，就性能和可伸缩性而言，这不是最好的解决方案，但它至少会让您起步。

一旦你有了版本控制系统和持续集成平台，你就可以开始改善你的开发伙伴的生活了。设置 SonarQube 有一个漂亮的视觉显示，这样其他人就可以看到你的团队在做什么。如果你能找到一个备用的显示器，给它附加一个简单的设备，比如 Raspberry Pi，然后把它放在你的团队区域的某个地方。

这些通常是我在团队中尝试采取的第一步。大多数团队已经有了版本控制。有时他们在旧的平台上，比如 Visual SourceSafe，这意味着你需要帮助他们迁移到 Git 或 TFVC。持续集成是很多团队仍然没有的东西。如果你有持续的集成，你可以集中你的技术债务管理，并向其他人展示你所做的改进。这也需要改变行为。检入损坏的代码和失败的 CI 构建不再是一个选项(从技术上讲，它仍然是一个选项，但不是一个好的选项)。让团队看到当前的构建状态是改进文化的好方法。表 [14-1](#Tab1) 显示了一份清单，你可以从基础开始使用。

表 14-1。

Checklist for DevOps Basics

   
| 面积 | 特征 | 描述 |
| --- | --- | --- |
| 全部的 | 工具作业 | 决定使用 Visual Studio、VS Team Services 还是 Team Foundation Server 和 Microsoft Azure。允许所有团队成员访问。 |
| 版本控制 | 类型 | 您需要为您的项目在 Git 和 TFVC 之间做出选择。你可以在 [`https://msdn.microsoft.com/en-us/Library/vs/alm/code/overview`](https://msdn.microsoft.com/en-us/Library/vs/alm/code/overview) 找到一些很棒的信息帮你做决定。 |
|   | 分支 | 你需要决定一个分支方案。这取决于您选择的版本控制类型。对 TFVC 来说，最简单的分支结构是最好的。对于 Git，您将创建更多的分支，但是仍然需要命名约定和保留策略。 |
|   | 政策 | 决定签入策略，例如要求注释、要求链接的工作项、本地构建和测试等。 |
|   | 代码审查 | 决定是否以及如何进行代码评审。TFVC 支持 Visual Studio 中的代码审查。Git 具有作为审查机制的拉请求。 |
|   | 功能切换 | 决定你是否要使用功能切换。选择一个框架，并围绕触发器的保留创建策略。 |
| 技术债务管理 | 单元测试 | 单元测试对于 DevOps 项目来说是必须的。在项目开始时决定单元测试框架和其他助手库。为代码覆盖率设定一个目标。 |
|   | 代码度量 | 为不同的代码度量设置阈值，并在项目期间验证这些阈值。 |
|   | 复制 | 为允许的重复代码量设置一个阈值。修复所有强重复和中等重复的结果。 |
|   | 架构验证 | 决定架构验证是否对您的项目有益。在建模项目中实现架构。 |
|   | 自定义代码分析器 | 决定使用定制的基于 Roslyn 的代码分析器。在团队中构建和分发您的分析器。 |
| 连续累计 | 构建定义 | 在项目开始时定义一个或多个生成定义。配置持续集成和计划构建的触发器。就构建失败的惩罚与您的团队达成一致。 |
|   | 代理和池 | 决定是否可以使用托管代理，或者是否需要添加自己的生成代理。 |
|   | 自定义生成任务 | 决定是否需要自定义构建任务来简化构建定义。 |
|   | 声纳员 | 安装和配置 SonarQube，以持续测量您的技术债务。 |
|   | 能见度 | 确保您项目的所有统计数据都可以在团队房间的监视器或电视上看到。使所有利益相关者能够监控项目的统计数据。 |

## 加快步伐

在有了版本控制、技术债务管理和持续集成的基础之后，我开始考虑持续交付。加速发布过程，即使只是到一个测试环境，也可以让你增加反馈周期。您可以将代理部署到您的内部基础架构，或者使用 Azure 和 spin up 虚拟环境或平台即服务(PaaS)资源来部署您的应用。如果您的一些配置设置很难自动管理，或者如果环境的设置不是自动化的，那么这不是等待构建交付管道的理由。如果有些步骤不是最佳的，那不是问题。一旦反馈周期开始，你就可以开始改进步骤，并立即看到你的行动带来的好处。

与此同时，团队可以开始审视他们构建的东西。引入敏捷项目管理工具需要时间。同样的原则也适用:以身作则。为什么不在一张纸上贴上你自己的小看板呢？然后你可以开始监控你自己的工作流程。在开始新的工作之前，你是否已经完成了一些项目？你有足够的信息从头到尾处理一个新的工作项目吗？向同事展示看板可以让他们看到这个想法。引入 Scrum 的概念，比如每日站立和持续改进，是很重要的。

如果你的团队或管理层不接受这些想法，你可以分发几本像凤凰计划( [`http://www.amazon.com/Phoenix-Project-DevOps-Helping-Business/dp/0988262509/`](http://www.amazon.com/Phoenix-Project-DevOps-Helping-Business/dp/0988262509/) )或软件在 30 天( [`http://www.amazon.com/Software-30-Days-Customers-Competitors/dp/1118206665/`](http://www.amazon.com/Software-30-Days-Customers-Competitors/dp/1118206665/) )这样的书。如果这是你的团队的痛点，就在这方面投资。如果你不清楚某些功能，为什么不使用 PowerPoint 故事板来勾画一个想法并与其他人讨论呢？为什么不发送一个反馈请求给某人来验证你已经做了正确的事情？

测试管理是另一个你可以改进的领域。根据我的经验，展示微软测试管理器的数据收集选项的演示足以让测试人员充满热情。结合动作记录和探索性测试，测试人员通常已经准备好开始使用 MTM 了。当您已经有了自动化的发布，测试人员可以在他们准备好的任何时候把一个新的版本推到他们的测试环境中，而不需要向开发人员请求一个新的部署。如果你使用敏捷项目管理工具，你也可以从 MTM 内部开始归档 bug，并将它们添加到团队的 backlog 中。

如果您有版本控制、技术债务管理、持续集成、持续部署、敏捷规划和测试管理，那么您就是一个可以做出巨大改进的专业团队。表 [14-2](#Tab2) 显示了不同步骤的概述。

表 14-2。

Checklist for DevOps Next Steps

   
| 面积 | 特征 | 描述 |
| --- | --- | --- |
| 连续交货 | 结构管理 | 将您所有的工件置于版本控制之下。这适用于源代码、数据库模式、配置设置以及部署所需的所有其他数据。 |
|   | 环境 | 决定你的开发/测试环境是在本地运行还是在 Azure 中运行。 |
|   | 发布管理 | 为自动部署配置发布管理。配置阶段、批准者和配置变量。 |
|   | 反馈周期 | 不要拿着 CD 等到一切都完美了。这永远不会发生。开始反馈循环，并对其进行改进，以发展您的团队及其流程。 |
| 敏捷项目管理 | 敏捷 | 确保你的团队在 Scrum 过程方面受过良好的教育。选择一个 Scrum 大师，确保你有一个产品负责人。开始处理待办事项，并关注 Scrum 会议。 |
|   | 看板法 | 将您的流程映射到看板板上。定义在制品限制。创建所需的泳道。开始寻找瓶颈，不断优化你的价值流。 |
|   | 投资组合管理 | 如果您有多个使用 VS 团队服务的团队，请将这些团队映射到 VS 团队服务中的团队。使用 epics 和 features 来安排工作，并将其分配给不同的团队。 |
|   | 仪表盘 | 用您的团队需要关注和改进的信息设置仪表板。 |
|   | 记事板制作 | 使用 Microsoft PowerPoint(或其他故事板工具)为您的产品待办事项创建故事板。将故事板附在 pbi 上，以创建可追溯性。 |
|   | 反馈管理 | 通过征求利益相关者的反馈让他们参与进来。 |
| 测试 | 人工测试 | 让测试人员参与进来，帮助他们使用 VS 团队服务。将 Microsoft 测试管理器交给您的测试人员，并帮助他们建立测试套件、计划和案例。 |
|   | 探索性测试 | 开始使用探索性测试来帮助加速测试过程。 |

## 收尾

最后，只剩下几个领域了:

*   自动化测试
*   监督和学习
*   性能和负载测试

自动化测试节省了测试人员大量的时间，并且使您能够加速您的部署，因为您有一个运行在每个新部署上的安全网。询问测试人员他们必须反复运行哪些测试来确保应用可以投入生产，这将显示哪些测试是自动化的主要候选。如果由于体系结构的原因，很难为您的应用编写单元测试，您可以从创建通过 UI 运行您的应用的编码 UI 测试开始。这使您能够重构代码片段，同时仍然确保应用不会崩溃，以引入更好的可测试设计。

另一个容易自动化的领域是性能和负载测试。您可以在几分钟内通过 VS Team Services 设置一个简单的负载测试。下一步是将它扩展成影响应用多个部分的真正的 web 测试。将此与应用洞察相结合，您就可以开始监控您的应用在生产中的可用性和性能。这允许您在出现问题时积极主动地解决问题，希望在第一个客户报告问题之前。应用洞察还可以用来监控应用的使用情况。哪些功能受欢迎？用户如何使用你的产品？这些问题可以帮助你确定投资方向。

所有这些特性都很难实现。我发现展示什么是可能的，让人们充满热情通常是最好的方式。当然，这条路并没有到此为止。微软通过 VS 团队服务提供的工具正在迅速发展。保持最新并了解新工具如何帮助您的组织非常重要，当更多的组织(包括您的竞争对手)应用 DevOps 原则时，这一点将变得更加重要。

你可以在 [`https://www.visualstudio.com/en-us/news/release-archive-vso`](https://www.visualstudio.com/en-us/news/release-archive-vso) 找到一个特征时间轴。微软使用这个页面来展示他们的 VS 团队服务路线图。您可以看到哪些功能正在开发中，并且通常会有讨论这些新功能的博客帖子的链接。这些博客大多可以在 [`http://blogs.msdn.com/b/visualstudioalm/`](http://blogs.msdn.com/b/visualstudioalm/) 找到。将这些博客添加到您最喜欢的 RSS 阅读器将有助于您了解最新动态。

微软还组织了一些大型会议，发布和讨论新功能。一年一度构建会议、Ignite 和 Visual Studio Connect 都包含对您有所帮助的会议。幸运的是，你可以在 [`https://channel9.msdn.com/`](https://channel9.msdn.com/) 网上找到这些课程。表 [14-3](#Tab3) 总结了最后这些要点。

表 14-3。

Checklist for the Finishing Touches

   
| 面积 | 特征 | 描述 |
| --- | --- | --- |
| 测试 | 自动化 UI 测试 | 通过自动化稳定的回归测试开始加速你的测试工作。 |
|   | 性能和负载测试 | 设置性能和负载测试。测试可以在几分钟内完成。Web 测试需要更多的关注，可以在项目过程中添加。 |
| 监视 | 应用洞察 | 为您的应用配置应用洞察，并开始监控关键指标。 |
|   | 添加事件 | 从您的代码中添加自定义事件到 Application Insights，开始了解您的用户对您的应用做了什么，以及您可以如何改进它。 |
| 保持最新状态 | 功能时间线 | 定期查看`visualstudio.com`上的特性时间表，确保你不会错过任何新特性，并且你知道接下来会有什么。 |
|   | 博客 | 开始关注热门博客，了解最新的新特性。 |
|   | 会议 | 参加会议或使用 Channel9 通知您所有新的可能性，以及如何将它们应用到您团队的项目中。 |

## 摘要

DevOps 是一个庞大的主题。希望这一章让你了解了你可以向你的团队和组织介绍的特性。从版本控制、持续集成和技术债务管理开始。然后继续进行持续交付、敏捷项目管理和测试管理。最后，您可以对测试自动化、性能和负载测试以及监控进行最后的润色。

我希望你的 DevOps 之旅成功！

-要牌吗